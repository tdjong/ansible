import jenkins.model.*
import hudson.model.*
import hudson.tasks.*
import hudson.tools.*
import java.security.*

def inst = Jenkins.getInstance()
def desc = inst.getDescriptor("hudson.model.JDK")

/*
jdks = [:]
jdks['NPLCM-jdk8u242-b08'] = []
jdks['NPLCM-jdk8u242-b08'] << ['label':'linux','url':'https://github.com/AdoptOpenJDK/openjdk8-binaries/releases/download/jdk8u242-b08/OpenJDK8U-jdk_x64_linux_hotspot_8u242b08.tar.gz','subdirectory':'jdk8u242-b08']
jdks['NPLCM-jdk8u242-b08'] << ['label':'windows','url':'https://github.com/AdoptOpenJDK/openjdk8-binaries/releases/download/jdk8u242-b08/OpenJDK8U-jdk_x86-32_windows_hotspot_8u242b08.zip','subdirectory':'jdk8u242-b08']
*/
jdks = [:]
{% for j in jenkins_auto_installers['jdk-tool'] %}
jdks['{{ j }}'] = []
{%   for i in jenkins_auto_installers['jdk-tool'][j] %}
jdks['{{ j }}'] << ['label':'{{ i['label'] }}','url':'{{ i['url'] }}','subdirectory':'{{ i['subdirectory'] }}']
{%   endfor %}
{% endfor %}

def installers = [];

for (j in jdks) {
  println 'JDK: ' + j.getKey()
  zipexs = []
  for (i in j.getValue()) {
    println '  url: ' + i['url']
    zipexs.add(new ZipExtractionInstaller(i['label'], i['url'], i['subdirectory']))
  }
  installerSource = new InstallSourceProperty(zipexs)
  installer = new hudson.model.JDK(j.getKey(),"",[installerSource])
  installers.add(installer)
}

desc.setInstallations(installers.toArray(new hudson.model.JDK[0]))
desc.save()

